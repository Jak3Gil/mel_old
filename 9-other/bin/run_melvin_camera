#!/bin/bash

# Melvin Camera Executable
# Double-click or run from terminal to see what Melvin sees!

clear

echo ""
echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
echo "‚ïë  üëÅÔ∏è MELVIN VISION - USB Camera                           ‚ïë"
echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
echo ""
echo "Starting Melvin's vision system..."
echo ""

# Get the directory where this script is located
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
cd "$SCRIPT_DIR/melvin"

# Check if camera diagnostic exists
if [ ! -f "test_camera.py" ]; then
    echo "‚ùå Error: Camera files not found"
    echo "   Make sure you're running from the Melvin directory"
    exit 1
fi

# Quick camera check
echo "üîç Detecting cameras..."
CAMERA_ID=$(python3 -c "
import cv2
for i in range(3):
    cap = cv2.VideoCapture(i)
    if cap.isOpened():
        ret, frame = cap.read()
        if ret and frame is not None and frame.size > 0:
            cap.release()
            print(i)
            exit(0)
    cap.release()
print(-1)
" 2>/dev/null)

if [ "$CAMERA_ID" = "-1" ]; then
    echo "‚ùå No camera found!"
    echo ""
    echo "Troubleshooting:"
    echo "  1. Check camera is plugged in"
    echo "  2. Close other apps (Zoom, FaceTime, etc.)"
    echo "  3. Check camera permissions"
    echo ""
    echo "Running test visualization instead (no camera needed):"
    echo ""
    python3 visualize_melvin.py
    exit 0
fi

echo "‚úÖ Found camera $CAMERA_ID"
echo ""
echo "Starting Melvin's vision..."
echo ""
echo "Controls:"
echo "  q - Quit"
echo "  p - Pause/Resume"
echo "  s - Save snapshot"
echo ""

# Run Melvin's vision
python3 melvin_sees.py "$CAMERA_ID"

echo ""
echo "‚úÖ Done!"

